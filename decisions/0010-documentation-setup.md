---
status: { accepted }
date: 2024-03-01
deciders: Shreyas, Eric, Mark M., Yan, Sierra, Donny
consulted:
informed: Emiley
---

# Simplify setup for documentation building

## Context and Problem Statement

Currently, the [NMDC documentation site](https://nmdc-documentation.readthedocs.io/) is generated by combining contents from two upstream Git repositories (i.e. [`nmdc-schema`](https://github.com/microbiomedata/nmdc-schema/) and [`workflow_documentation`](https://github.com/microbiomedata/workflow_documentation)) with the contents of a third one (i.e. [`NMDC_Documentation`](https://github.com/microbiomedata/NMDC_documentation)); merging all of those contents into a single, Sphinx-compatible file tree; committing that file tree to the third repository; and initiating a "Pull & Build" step via the **Read the Docs** (RTD) website. This involves manual steps, and merger scripts that will require ongoing maintenance.

Meanwhile, the `nmdc-schema` and `workflow_documentation` maintainers each already have their own routines for deploying their respective projects' documentation to the Internet (i.e. [here](https://microbiomedata.github.io/nmdc-schema/) and [here](https://nmdc-workflow-documentation.readthedocs.io/), respectively). As a result, there are two copies of the `nmdc-schema` documentation on the Internet at the same time (i.e. one deployed by the `nmdc-schema` maintainers and one deployed—independently—by the `NMDC_Documentation` maintainers), which leaves open the possibility that the copies fall out of sync with one another. The same is true about the `workflow_documentation` project documentation.

We want to avoid the **ongoing maintenance** of the merger scripts, the **manual steps** of running them, and the **duplication of documentation**.

## Considered Options

1. Continue using the "merger script" approach (see problem statements above).

```mermaid
---
title: The merger script approach
---
graph BT;
    subgraph "GH repo: NMDC_Documentation repo"
        core_doc_src["Core+Schema+Workflow docs MD/RST"]
    end

    subgraph "GH repo: nmdc-schema"
        schema_doc_src["Schema docs MD"]
    end

    workflow_doc_src --> | RTD Pull & Build | workflow_doc_dist
    schema_doc_src --> | GHA Build & Push | schema_doc_dist
    workflow_doc_src --> | Scripted Build & Merge | core_doc_src
    schema_doc_src --> | Scripted Build & Merge | core_doc_src
    
    subgraph "GH repo: workflow_documentation"
        workflow_doc_src["Workflow docs MD/RST"]
    end

    subgraph "RTD project: nmdc-workflow-documentation"
        workflow_doc_dist["Workflow docs HTML"]
    end

    subgraph "GitHub Pages"
        schema_doc_dist["Schema docs HTML"]
    end

    subgraph "RTD project: nmdc-documentation"
        main_doc_dist["Core+Schema+Workflow docs HTML"]
    end

    core_doc_src --> | RTD Pull & Build | main_doc_dist
```

2. Switch to a "link out" approach. Instead of merging the documentation into a single site, we will update the core documentation (one time) so that it prominently displays links to the two other documentation sites. That will eliminate both the merge step and the duplication of documentation\*. 

   > \***Caveat:** In order to avoid breaking any existing links that our readers may have saved, we will refrain from deleting the already-merged-in content for now. We may eventually replace that content with redirects, or discard it altogether (TBD). We will not continue to update it, though—it will remain in its current state even as the core documentation around it gets updated.

```mermaid
---
title: The link out approach
---
graph BT;
    subgraph "GH repo: NMDC_Documentation"
        core_doc_src["Core docs MD/RST"]
    end

    subgraph "GH repo: nmdc-schema"
        schema_doc_src["Schema docs MD"]
    end

    subgraph "GitHub Pages"
        schema_doc_dist["Schema docs HTML"]
    end

    subgraph "GH repo: workflow_documentation"
        workflow_doc_src["Workflow docs MD/RST"]
    end

    subgraph "RTD project: nmdc-workflow-documentation"
        workflow_doc_dist["Workflow docs HTML"]
    end

    subgraph "RTD project: nmdc-documentation"
        core_doc_dist["Core docs HTML"]
    end

    core_doc_dist -.-> | Link out | workflow_doc_dist
    workflow_doc_src --> | RTD Pull & Build | workflow_doc_dist
    core_doc_src --> | RTD Pull & Build | core_doc_dist
    schema_doc_src --> | GHA Build & Push | schema_doc_dist
    core_doc_dist -.-> | Link out | schema_doc_dist
```

## Decision Outcome

- **Chosen option:** 2. Switch to a "link out" approach.

## Future Considerations

- [ ] Move the core documentation and the workflow documentation from Read the Docs to GitHub Pages in an attempt to simplify account management.
- [x] Move ADRs out of the `NMDC_Documentation` repo and into a repo more suitable for project management (i.e. the `issues` repo).
